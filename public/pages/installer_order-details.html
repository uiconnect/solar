
<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>8 Minutes Energy: Order List</title>
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<link href="/public/bootstrap/css/bootstrap.css" rel="stylesheet" type="text/css" />
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
	<link href="/public/plugins/select2/select2.min.css" rel="stylesheet" type="text/css" />	
	<link href="/public/dist/css/8minutes.css" rel="stylesheet" type="text/css" />
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	<style type="text/css">
		.popover{
			max-width:100%;
			height:200px;
			margin-left:200px;
		}		
	    #map {
			width: 350px;
			height: 200px;
		}
	</style>
</head>
<body class="container-fluid" style="background-color:#f0f0f0;">
<div class="row">
	<div class="col-xs-12 topHeader e-shadow1 bg-white" style="position:fixed; z-index:100; ">
		<div class="row">
			<div class="col-xs-11">
				<img src="/public/dist/img/logo_8minutes.png" alt="8Minutes Logo">
				<div class="pull-right grey" style="padding-top:20px;">
					<a href="installer_order-list.html" class="navActive">Orders</a>&#8226;
					<a href="#" id="profile" class="navInactive">Profile</a>&#8226;
				</div>
			</div>
			<div class="col-xs-1" style="padding-top:20px;">
				<div class="profileImg" style="background-image:url('/public/dist/img/me1.jpg');">&nbsp;</div>
				<div class="dropdown" style="display:inline;">
				  <a href="#" class="dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style="border:0;">
				   <span class="caret"></span>
				  </a>
				  <ul class="dropdown-menu dropdown-menu-right" style="font-size:12px" aria-labelledby="dropdownMenu1">
				    <li><a href="#" id="logout">LOGOUT</a></li>
				  </ul>
				</div>
			</div>
		</div>
	</div>
</div>
<p style="margin-top:80px;">

<div class="row">
	<div class="col-sm-1"></div>
	<div class="col-sm-10">
		<div class="box">
			<div class="row" style="background-color:#f8f8f8;">
				<div class="col-xs-12">
					<h3 class="text-grey text-center" style="margin:20px 0;">Owner Details</h3>
				</div>
			</div>
			<p style="margin:20px;">
			<div class="row">
				<div class="col-xs-5 t-label">Owner Name</div>
				<div class="col-xs-7 t-data" id="ownerName" ></div>
			</div>
			<hr>
			<div class="row">
				<div class="col-xs-5 t-label">Email</div>
				<div class="col-xs-7 t-data" id="ownerEmail" ></div>
			</div>
			<hr>
			<div class="row">
				<div class="col-xs-5 t-label">Phone</div>
				<div class="col-xs-7 t-data" id="mobile"></div>
			</div>			
		</div>
	</div>
	<div class="col-sm-1"></div>
</div>
<!-- Location details -->
<div class="row">
	<div class="col-sm-1"></div>
	<div class="col-sm-10">
		<div class="box">
			<div class="row" style="background-color:#f8f8f8;">
				<div class="col-xs-12">
					<h3 class="text-grey text-center" style="margin:20px 0;">Installation Location Details</h3>
				</div>
			</div>
			<p style="margin:20px;">
			<div class="row">
				<div class="col-xs-5 t-label">Address</div>
				<div class="col-xs-7 t-data" id="address" ></div>
			</div>
			<hr>
			<div class="row">
				<div class="col-xs-5 t-label">Type</div>
				<div class="col-xs-7 t-data" id="locationType" ></div>
			</div>
			<hr>
			<div class="row">
				<div class="col-xs-5 t-label">Rooftop Area</div>
				<div class="col-xs-7 t-data"><h3 style="margin:0;"><span id="roofTopArea"></span>&nbsp;<small>sq.ft.</small></h3></div>
			</div>
			<hr>
			<div class="row">
				<div class="col-xs-5 t-label">Average Monthly Bill</div>
				<div class="col-xs-7 t-data"><h3 style="margin:0;"><span id="avgBill"></span>&nbsp;<small><i class="fa fa-inr mar-r5"></i></small></h3></div>
			</div>			
		</div>
	</div>
	<div class="col-sm-1"></div>
</div>
<!-- Visit request details -->
<div class="row">
	<div class="col-sm-1"></div>
	<div class="col-sm-10">
		<div class="box">
			<div class="row" style="background-color:#f8f8f8;">
				<div class="col-xs-12">
					<h3 class="text-grey text-center" style="margin:20px 0;">Installation Visit Request Details</h3>
				</div>
			</div>
			<p style="margin:20px;">
			<div class="row">
				<div class="col-xs-5 t-label">Customer Requested Date & Time of Visit</div>
				<div class="col-xs-7 t-data" id="visitDateTime" ></div>
			</div>
			<hr>
			<div class="row">
				<div class="col-xs-5 t-label"> Actual Visit Date & Time</div>
				<div class="col-xs-7 t-data">
					<div class="input-group" style="width:150px; padding:0px; padding-bottom:5px;">
					  <input type="text" class="form-control" aria-label="" id="actVisitDate">
					  <div id="actVisitDateCnt"></div>
					  <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
					</div>
					<select required id="act_visited_time" class="select2 text-left" style="display:inline; width:150px;">		
						 <option selected> 9 am</option>
						 <option> 10 am</option>
						 <option> 11 am</option>
						 <option> 12 PM</option>
						 <option> 1 PM</option>
						 <option> 2 PM</option>
						 <option> 3 PM</option>
						 <option> 4 PM</option>
						 <option> 5 PM</option>
						 <option> 6 PM</option>
						 <option> 7 PM</option>
						 <option> 8 PM</option>
						 <option> 9 PM</option>
					</select> <br><br>
					<button class="btn btn-default" id="visitUpdate">Update</button></div>
			</div>
		</div>
	</div>
	<div class="col-sm-1"></div>
</div>
<!--div class="row">
	<div class="col-sm-1"></div>
	<div class="col-sm-10">
		<div class="box">
			<div class="row" style="background-color:#f8f8f8;">
				<div class="col-xs-12">
					<h3 class="text-grey text-center" style="margin:20px 0;">Installation Feedback</h3>
				</div>
			</div>
			<p style="margin:20px;">
			<div class="row">
				<div class="col-sm-12">
					<div class="row" style="padding-top:30px;">
						<div class="col-xs-1 text-right"></div>				
						<div class="col-xs-6"></div>
						<div class="col-xs-1 text-left">
							<h5 class="text-center"><b>Yes</b></h5>
						</div>
						<div class="col-xs-1 text-center">
							<h5><b>No</b></h5>
						</div>
						<div class="col-xs-3"></div>
					</div>
					<div class="row" style="padding-top:30px;">
						<div class="col-xs-1 text-right"></div>				
						<div class="col-xs-6 text-left"><h5>1. Was the site visit representative on time?</h5></div>
						<div class="col-xs-1 text-center">
							  <input type="checkbox">
						</div>
						<div class="col-xs-1 text-center">
							  <input type="checkbox">
						</div>
						<div class="col-xs-3"></div>
					</div>
					<div class="row" style="padding-top:30px;">
						<div class="col-xs-1"></div>				
						<div class="col-xs-6 text-left"><h5>2. Have you discussed your preferences on the rooftop with the representative?</h5></div>
						<div class="col-xs-1 text-center">
							  <input type="checkbox">
						</div>
						<div class="col-xs-1 text-center">
							  <input type="checkbox">
						</div>
						<div class="col-xs-3"></div>
					</div>
					<div class="row" style="padding-top:30px;">
						<div class="col-xs-1"></div>				
						<div class="col-xs-6 text-left"><h5>3. Did the partner explain the tentative positioning of the system on your rooftop?</h5></div>
						<div class="col-xs-1 text-center">
							  <input type="checkbox">
						</div>
						<div class="col-xs-1 text-center">
							  <input type="checkbox">
						</div>
						<div class="col-xs-3"></div>
					</div>
					<div class="row" style="padding-top:30px;">
						<div class="col-xs-1"></div>				
						<div class="col-xs-6 text-left"><h5>4. Was the partner able to answer all your questions?</h5></div>
						<div class="col-xs-1 text-center">
							  <input type="checkbox">
						</div>
						<div class="col-xs-1 text-center">
							  <input type="checkbox">
						</div>
						<div class="col-xs-3"></div>
					</div>
					<div class="row" style="padding-top:30px;">
						<div class="col-xs-1"></div>				
						<div class="col-xs-6 text-left"><h5>5. Which payment option seems attractive to you?</h5></div>
						<div class="col-xs-1 text-center">
							  <input type="checkbox">
						</div>
						<div class="col-xs-1 text-center">
							  <input type="checkbox">
						</div>
						<div class="col-xs-3"></div>
					</div>
					<div class="row" style="padding-top:30px;">
						<div class="col-xs-1"></div>				
						<div class="col-xs-6 text-left"><h5>6. How would you rate the experience? (Rate us out of 5)</h5></div>
						<div class="col-xs-5">
							  <input type="radio" style="margin-right:5px;" name="rating" value="V.Good">1
							  <input type="radio" style="margin-right:5px; margin-left:10px;" name="rating" value="Good">2
							  <input type="radio" style="margin-right:5px; margin-left:10px;" name="rating" value="OK">3
							  <input type="radio" style="margin-right:5px; margin-left:10px;" name="rating" value="Bad">4
							  <input type="radio" style="margin-right:5px; margin-left:10px;" name="rating" value="V.Bad">5
						</div>
					</div>
					<div class="row" style="padding-top:30px;">
						<div class="col-xs-1"></div>						
						<div class="col-xs-6 text-right">Any feedback for us?</div>
						<div class="col-xs-5">
							  <textarea rows="5" class="form-control" id="fb" style="width:90%;"></textarea>
						</div>
					</div>
				</div>
			</div>
			<p>
			<div class="text-center"><button class="btn btn-default" id="feedBackUpdate" >Update</button></div>
		</div>
	<div class="col-sm-1"></div>
</div>
<div class="row">
	<div class="col-xs-12 text-center pad20">
		<button class="btn btn-default" style="width:200px;" onClick="document.location.href='installer_order-list.html'">Save & Close</button>
	</div>
</div-->
<script src="/public/plugins/jQuery/jQuery-2.1.4.min.js" type="text/javascript"></script>
<script src="/public/dist/js/index.js"></script>
<!-- jQuery 1.12.4 -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<!-- Bootstrap 3.3.78.5463 JS -->
<script src="/public/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<!-- Select2: plugin for styling select boxes -->
<script src="/public/plugins/select2/select2.full.min.js" type="text/javascript"></script>
<!-- angular JS-->
<script src="/public/plugins/angular/angular.min.js"></script>
<script src="/public/dist/js/search.js"></script>
<script type="text/javascript">
$(function () {
	//Initialize Select2 Elements
	$(".select2").select2();
});
</script>
<script>
  function initialize() {
    var mapCanvas = document.getElementById('map');
    var mapOptions = {
      center: new google.maps.LatLng(44.5403, 78.5463),
      zoom: 8,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    }
    var map = new google.maps.Map(mapCanvas, mapOptions)
  }
  google.maps.event.addDomListener(window, 'load', initialize);
</script>
  </body>
</html>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div style="padding:20px;"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>
			<div class="modal-body" style="padding:0 50px;">
			<h3 id="myModalLabel">Update visit details</h3>
				<div class="row">
					<div class="col-xs-4">
						<select class="select2" style="width:100%;">
							<option>First Visit</option>
							<option>Re-visit</option>							
						</select>
					</div>
					<div class="col-xs-4">
						<select class="select2" style="width:100%;">
							<option>Customer met</option>
							<option>Customer did not meet</option>							
						</select>
					</div>
					<div class="col-xs-4">
						<div class="input-group" style="width:150px; padding:0px; padding-bottom:5px;">
						  <input type="text" class="form-control" aria-label="">
						  <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
						</div>
					</div>
				</div>									
			</div>
			<div class="modal-footer" style="border-top:0;">
				<div class="text-center"><button type="button" class="btn btn-warning" onClick="document.location.href='installer_order-details.html'">Update</button></div>
			</div>
		</div>
	</div>
</div>



<!-- Modal -->
<div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div style="padding:20px;"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>
			<div class="modal-body" style="padding:0 50px;">
			<h3 id="myModalLabel">Edit your profile</h3>
			<p style="margin:30px auto;">
			<div class="row">
				<div class="col-xs-5">
					New Password
				</div>
				<div class="col-xs-7">
					<input type="checkbox" id="samepassCheckbox" checked value="same" >
					<label for="samepassCheckbox">Same as previouse</label>
					<input id="newPassword" style="display:none" type="password" class="form-control" style="width:100%;">
					<h6>New password</h6>
				</div>
			</div>
			
			<div class="row">
				<div class="col-xs-5">Installer Name</div>
				<div class="col-xs-7">
					<input type="text" class="form-control" id="inst-name">
				</div>
			</div>
			<hr style="margin:5px;">
			<div class="row">
				<div class="col-xs-5">Email</div>
				<div class="col-xs-7">
					<input type="text" class="form-control" id="inst-email" required >
				</div>
			</div>
			<hr style="margin:5px;">
			<div class="row">
				<div class="col-xs-5">Phone</div>
				<div class="col-xs-7">
					<input type="text" class="form-control" id="inst-phone">
				</div>
			</div>
			<hr style="margin:5px;">
			<div class="row">
				<div class="col-xs-5">Description</div>
				<div class="col-xs-7">
					<input type="text" class="form-control" id="inst-desc">
				</div>
			</div>
			<hr style="margin:5px;">
			<div class="row">
				<div class="col-xs-5">Location</div>
				<div class="col-xs-7">
					<input type="text" class="form-control" id="inst-location">
				</div>
			</div>
			<hr style="margin:5px;">
			<div class="row">
				<div class="col-xs-5">Photo</div>
				<div class="col-xs-7">
					<input type="file" class="form-control" id="inst-photo">
				</div>
			</div>
			<p style="margin:30px auto;">				
			For any further clarification with the client please contact client at: <b>+91-7822-094-340</b> or email at: <a href="#">clientname@gmail.com</a>
			Regards,<br>
			<div class="modal-footer" style="border-top:0;">
				<div class="text-center">
					<button type="button" class="btn btn-warning" id="update">Update</button>					
				</div>
				
			</div>
		</div>

		
	</div>
</div>


<script type="text/javascript" src="/public/dist/js/monthly.js"></script>
<link rel="stylesheet" href="/public/dist/css/monthly.css"/>

<script type="text/javascript">
	
	$(function(){

		var id = window.location.hash.split("");
		id.shift();
		id = id.join('');

		if(!id){
			document.location.href = "installer_order-list.html"
		}

		$('#actVisitDateCnt').monthly({
			mode        : 'picker',
			target      : '#actVisitDate',
			setWidth    : '250px',
			startHidden : true,
			showTrigger : '#actVisitDate',
			stylePast   : true,
			disablePast : false
		});

		$("#profile").on("click",function () {
			$('#myModal1').modal("show");
		})

		var instId;
		$("#update").on("click", function(){
		    
			var data = {
						desc     : $("#inst-desc").val(),
						email    : $("#inst-email").val(),
						location : $("#inst-location").val(),
						phone    : $("#inst-phone").val(),
						name     : $("#inst-name").val(),
						token    : window.sessionStorage.token

				};


			var reader = new FileReader();
			var self = this;
			reader.onload = function (e) {
				data.pic = e.target.result;
		    
				if($("#newPassword").val() && $("#newPassword").val()!=""){
					data["password"] = $("#newPassword").val()
				}

			    $.ajax({
					url:"/api/installer/"+instId,
					type:"PATCH",
					data:data,
					error:function(d){
						showNotification("error: "+d.error,"error")
						
					},
					success: function (d) {
						showNotification("Success ! Profile details are updated","success");
						$("#myModal1").modal("hide");
					}
				})
			}
			reader.readAsDataURL($("#inst-photo")[0].files[0]);

		})
		$("#samepassCheckbox").on("change", function(){
			if($(this).is(":checked")){
				$("#newPassword").hide()
			}else{
				$("#newPassword").show()
			}
		});


		$.ajax({
				url:"/api/installer/id",
				type:"POST",
				data:{token:window.sessionStorage.token},
				success: function (d) {
					instId = d._id;
					$("#inst-desc").val(d.desc)
					$("#inst-email").val(d.email)
					$("#inst-location").val(d.location)
					$("#inst-phone").val(d.phone)
					$("#inst-name").val(d.name)
				}
			})

		$.ajax({
			url:"/api/requirement/" + id,
			type:"POST",
			data:{token:window.sessionStorage.token},
			error:function(){
				document.location.href = "installer_order-list.html"
			},
			success: function (item) {
				$("#orderId").html(item.orderid)
				$("#ownerName").html(item.owner_salutation + " "+ item.owner_fname+ " "+ item.owner_lname)
				$("#ownerEmail").html(item.owner_email)
				$("#mobile").html(item.owner_phone)
				$("#address").html(item.address_l1 + " <br> " + item.address_l2 + " <br> " + item.location)
				$("#locationType").html(item.installAt)
				$("#roofTopArea").html(item.rooftop_area)
				$("#avgBill").html(item.current_avg_bill)
				$("#visitDateTime").html(dateFormat(item.req_visit_date) +"  "+ (item.req_visit_time));
				$("#actVisitDate").val(item.act_visit_date)
				//$("#visit_time").val(item.act_visit_time)
			}
		})


		$.ajax({
			url:"/api/feedback/" + id,
			type:"POST",
			data:{token:window.sessionStorage.token},
			error:function(){
				document.location.href = "installer_order-list.html"
			},
			success: function (d) {
				$("#fb").html(d.inst_feedback)
			}
		})

		$("#feedBackUpdate").on("click", function(){
			$.ajax({
				url:"/api/feedback",
				type:"POST",
				data:{_id:id,inst_feedback:$("#fb").val(),token:window.sessionStorage.token},
				error:function(){
					$.ajax({
						url:"/api/feedback/" + id,
						type:"PATCH",
						data:{inst_feedback:$("#fb").val(),token:window.sessionStorage.token},
						error:function(){
							document.location.href = "installer_order-list.html"
						},
						success: function (d) {
							showNotification("Success ! Your feedback is updated","success");
						}
					})
				},
				success: function (d) {
					showNotification("Success ! Your feedback is updated","success");
				}
			})
		})
		$("#visitUpdate").on("click", function(){
			$.ajax({
				url:"/api/requirement/" + id,
				type:"PATCH",
				data:{
							act_visit_time : $("#act_visited_time").val(),
							act_visit_date : $("#actVisitDate").val(),
							token          : window.sessionStorage.token
					},
				error:function(){
					document.location.href = "installer_order-list.html"
				},
				success: function (d) {
					showNotification("Success ! Date infermation is updated","success");
				}
			})
		})
	})
</script>
